<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nordic Racing Analytics Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #0f172a;
        }

        .header {
            background: #0f172a;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav {
            background: white;
            padding: 0 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
        }

        .nav-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .nav-item:hover {
            background: #f8fafc;
        }

        .nav-item.active {
            border-bottom-color: #1e40af;
            color: #1e40af;
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            color: #475569;
            font-size: 0.875rem;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #0f172a;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .card-body {
            padding: 1.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 12px;
            font-weight: 600;
            color: #475569;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
            font-size: 0.875rem;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .view-container {
            display: none;
        }

        .view-container.active {
            display: block;
        }

        button {
            padding: 8px 16px;
            background: #1e40af;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        button:hover {
            background: #1e3a8a;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span>üèá</span>
                <span>Nordic Racing Analytics</span>
            </div>
            <div id="syncStatus">
                <span>Ready</span>
            </div>
        </div>
    </header>

    <nav class="nav">
        <div class="nav-content">
            <div class="nav-item active" onclick="switchView('dashboard')">Dashboard</div>
            <div class="nav-item" onclick="switchView('courses')">Course Analysis</div>
            <div class="nav-item" onclick="switchView('predictor')">Race Predictor</div>
        </div>
    </nav>

    <div class="container">
        <!-- Dashboard View -->
        <div class="view-container active" id="dashboard-view">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Races</div>
                    <div class="stat-value" id="totalRaces">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Unique Horses</div>
                    <div class="stat-value" id="uniqueHorses">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Jockeys</div>
                    <div class="stat-value" id="totalJockeys">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Courses</div>
                    <div class="stat-value" id="totalCourses">0</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Recent Races</h2>
                    <button onclick="loadData()">Refresh Data</button>
                </div>
                <div class="card-body">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Course</th>
                                <th>Winner</th>
                                <th>Jockey</th>
                                <th>Odds</th>
                            </tr>
                        </thead>
                        <tbody id="racesTable">
                            <tr><td colspan="5">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Course Analysis View -->
        <div class="view-container" id="courses-view">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Course Analysis - Klampenborg</h2>
                    <button onclick="loadCourseAnalysis()">Load Analysis</button>
                </div>
                <div class="card-body">
                    <!-- Filters -->
                    <div style="margin-bottom: 2rem;">
                        <select id="monthFilter" onchange="filterData()" style="padding: 8px; margin-right: 10px;">
                            <option value="all">All Months</option>
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <select id="distanceFilter" onchange="filterData()" style="padding: 8px;">
                            <option value="all">All Distances</option>
                            <option value="sprint">Sprint (1000-1400m)</option>
                            <option value="mile">Mile (1500-1800m)</option>
                            <option value="stayer">Stayer (1800m+)</option>
                        </select>
                    </div>

                    <!-- Analysis sections -->
                    <div id="courseAnalysisContent">
                        <p>Click "Load Analysis" to view course statistics</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Race Predictor View -->
        <div class="view-container" id="predictor-view">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Race Predictor</h2>
                </div>
                <div class="card-body">
                    <p>Coming soon...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let racingData = [];
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTvMVuVB0xdAbPxg9fvRHnHLZiGm0gHh4ygYSin-2lACKqhzmXtEZb78AxIru1gJl2WnD6-XfFqCoUX/pub?gid=0&single=true&output=csv';

        // Switch views
        function switchView(view) {
            document.querySelectorAll('.view-container').forEach(el => {
                el.classList.remove('active');
            });
            document.getElementById(view + '-view').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Load data
        async function loadData() {
            try {
                document.getElementById('syncStatus').textContent = 'Loading...';
                const response = await fetch(SHEET_URL);
                const text = await response.text();
                racingData = parseCSV(text);
                updateDashboard();
                document.getElementById('syncStatus').textContent = 'Data loaded';
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('syncStatus').textContent = 'Error loading';
            }
        }

        // Parse CSV
        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split(',');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((header, index) => {
                    row[header.trim()] = values[index] ? values[index].trim() : '';
                });
                if (row.Horse) data.push(row);
            }
            return data;
        }

        // Update dashboard
        function updateDashboard() {
            // Calculate stats
            const horses = new Set();
            const jockeys = new Set();
            const courses = new Set();
            const races = new Set();
            
            racingData.forEach(row => {
                if (row.Horse) horses.add(row.Horse);
                if (row.Jockey) jockeys.add(row.Jockey);
                if (row.Course) courses.add(row.Course);
                races.add(row.Course + row.Date + row['Race of the Day']);
            });
            
            document.getElementById('totalRaces').textContent = races.size;
            document.getElementById('uniqueHorses').textContent = horses.size;
            document.getElementById('totalJockeys').textContent = jockeys.size;
            document.getElementById('totalCourses').textContent = courses.size;
            
            // Update races table
            const tbody = document.getElementById('racesTable');
            const winners = racingData.filter(r => r.Place === '1').slice(0, 10);
            
            let html = '';
            winners.forEach(race => {
                html += '<tr>';
                html += '<td>' + (race.Date || '-') + '</td>';
                html += '<td>' + (race.Course || '-') + '</td>';
                html += '<td>' + (race.Horse || '-') + '</td>';
                html += '<td>' + (race.Jockey || '-') + '</td>';
                html += '<td>' + (race.Odds || '-') + '</td>';
                html += '</tr>';
            });
            tbody.innerHTML = html || '<tr><td colspan="5">No data</td></tr>';
        }

        // Load course analysis
        function loadCourseAnalysis() {
            const klampenborg = racingData.filter(r => r.Course && r.Course.includes('Klampenborg'));
            
            let html = '<h3>Post Position Analysis</h3>';
            html += '<table><tr><th>Post</th><th>Wins</th><th>Runs</th><th>Win%</th></tr>';
            
            const postStats = {};
            klampenborg.forEach(race => {
                const post = parseInt(race.Startspor) || 0;
                if (post > 0) {
                    if (!postStats[post]) postStats[post] = {wins: 0, runs: 0};
                    postStats[post].runs++;
                    if (race.Place === '1') postStats[post].wins++;
                }
            });
            
            for (let i = 1; i <= 10; i++) {
                if (postStats[i]) {
                    const winPct = ((postStats[i].wins / postStats[i].runs) * 100).toFixed(1);
                    html += '<tr>';
                    html += '<td>' + i + '</td>';
                    html += '<td>' + postStats[i].wins + '</td>';
                    html += '<td>' + postStats[i].runs + '</td>';
                    html += '<td>' + winPct + '%</td>';
                    html += '</tr>';
                }
            }
            html += '</table>';
            
            document.getElementById('courseAnalysisContent').innerHTML = html;
        }

        // Filter data
        function filterData() {
            // This would filter the course analysis
            loadCourseAnalysis();
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
